<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Walkies - Dog Walking App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for Design System */
        :root {
            --primary-color: #8A2BE2; /* A nice purple */
            --primary-color-light: #9370DB;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-color: #E0E0E0;
            --text-color-dark: #333;
            --shadow-light: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            --shadow-strong: 0 12px 40px 0 rgba(31, 38, 135, 0.37);
            --border-radius: 1rem;
            --font-family: 'Inter', sans-serif;
        }

        /* Base Styles & Gradient Background */
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, #1e0033 0%, #3d1c5a 50%, #5f3781 100%);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            flex-direction: column;
        }
        
        /* Floating Blur Effects */
        body::before, body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            z-index: -1;
            opacity: 0.4;
            animation: float 20s infinite alternate;
        }
        body::before {
            width: 300px; height: 300px;
            background-color: #9370DB;
            top: -50px; left: -100px;
        }
        body::after {
            width: 400px; height: 400px;
            background-color: #8A2BE2;
            bottom: -100px; right: -150px;
            animation-direction: alternate-reverse;
        }
        @keyframes float {
            to { transform: translateY(40px) translateX(20px) scale(1.1); }
        }

        /* App Layout */
        .app-container {
            display: none; /* Hide by default to let JS control visibility */
            flex-direction: column;
            height: 100%;
        }
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1.5rem 1rem 8rem 1rem; /* Padding for bottom nav */
        }
        .page-content-wrapper {
             width: 100%;
             max-width: 420px;
             margin: 0 auto;
        }

        /* Page Transitions */
        .page { display: none; }
        .page.active { display: block; }
        
        /* Booking Flow Screen Transitions */
        .booking-flow-page .screen {
            opacity: 0;
            visibility: hidden;
            transform: translateX(30px);
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out, visibility 0.4s;
            pointer-events: none;
            display: none;
        }
        .booking-flow-page .screen.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
            pointer-events: auto;
            display: block;
        }


        /* Reusable Components */
        .glass-card {
            background: var(--glass-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
        }
        .glass-card:hover:not(.non-hover) {
            box-shadow: var(--shadow-strong);
            transform: translateY(-4px);
        }
        .btn {
            padding: 0.875rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }
        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
        }
        .btn-primary:hover:not(:disabled) {
            background: var(--primary-color-light);
            box-shadow: 0 6px 20px rgba(147, 112, 219, 0.5);
            transform: translateY(-2px);
        }
        .btn:disabled {
            background: rgba(147, 112, 219, 0.4);
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn-secondary {
            background: var(--glass-bg);
            color: var(--text-color);
            border: 1px solid var(--glass-border);
        }
        .input-group {
            position: relative;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
        }
        .input-group:focus-within {
            border-color: var(--primary-color-light);
            box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.4);
        }
        .input-field {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-color);
            padding: 0.875rem 1rem;
            font-size: 1rem;
        }
        .input-field::placeholder { color: rgba(224, 224, 224, 0.6); }
        .page-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .page-header h1 {
            flex-grow: 1;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
        }
        .page-header .back-btn {
            margin-right: auto;
        }
        .page-header .placeholder { /* To balance the back button */
             width: 40px; 
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 420px;
            margin: 0 auto 1.5rem auto;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 99px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-around;
            padding: 0.75rem 0.5rem;
            box-shadow: var(--shadow-strong);
            z-index: 50;
        }
        .nav-item {
            background: none; border: none; color: rgba(255,255,255,0.6); display: flex; flex-direction: column;
            align-items: center; font-size: 0.7rem; gap: 0.2rem; padding: 0 0.5rem; transition: all 0.3s ease;
        }
        .nav-item.active { color: white; }
        .nav-item.active svg { color: var(--primary-color-light); }

        /* Staggered Animation */
        .stagger-in > * {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        /* Booking Flow Specific Styles */
        #page-booking-flow .progress-bar { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 2rem; position: relative; }
        #page-booking-flow .progress-line { position: absolute; height: 4px; background: var(--glass-border); width: 100%; top: 50%; transform: translateY(-50%); z-index: 1; }
        #page-booking-flow .progress-line-active { position: absolute; height: 4px; background: var(--primary-color-light); width: 0; top: 50%; transform: translateY(-50%); z-index: 2; transition: width 0.5s ease-in-out; }
        #page-booking-flow .progress-step { display: flex; flex-direction: column; align-items: center; z-index: 3; position: relative; }
        #page-booking-flow .progress-icon { width: 40px; height: 40px; border-radius: 50%; background: var(--glass-bg); border: 2px solid var(--glass-border); display: flex; justify-content: center; align-items: center; transition: all 0.4s ease; }
        #page-booking-flow .progress-step.active .progress-icon { background: var(--primary-color-light); border-color: var(--primary-color); transform: scale(1.1); }
        #page-booking-flow .progress-label { margin-top: 0.5rem; font-size: 0.75rem; font-weight: 500; opacity: 0.7; transition: opacity 0.4s ease; }
        #page-booking-flow .progress-step.active .progress-label { opacity: 1; }
        #page-booking-flow .checkable-card { cursor: pointer; position: relative; text-align: center; }
        #page-booking-flow .checkable-card input { display: none; }
        #page-booking-flow .checkable-card input:checked + .card-content { border-color: var(--primary-color-light); box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.4); }
        #page-booking-flow .checkmark { position: absolute; top: 0.75rem; right: 0.75rem; width: 24px; height: 24px; background: rgba(0,0,0,0.3); border-radius: 50%; display: flex; justify-content: center; align-items: center; opacity: 0; transform: scale(0.5); transition: all 0.3s ease; }
        #page-booking-flow .checkable-card input:checked ~ .checkmark { opacity: 1; transform: scale(1); background: var(--primary-color); }
        
        /* Chat Page Styles */
        #page-chat .chat-bubble { max-width: 75%; padding: 0.75rem 1rem; border-radius: 1.25rem; }
        #page-chat .chat-bubble.user { background: var(--primary-color); color: white; border-bottom-right-radius: 0.25rem; }
        #page-chat .chat-bubble.walker { background: var(--glass-bg); border-bottom-left-radius: 0.25rem; }
        
        /* Favorite Button */
        .favorite-btn { background: none; border: none; cursor: pointer; color: var(--text-color); transition: all 0.3s ease; }
        .favorite-btn.favorited { color: #F472B6; /* A nice pink */ }
        .favorite-btn svg { stroke: currentColor; transition: fill 0.3s ease; }
        .favorite-btn.favorited svg { fill: currentColor; }

        /* Onboarding Styles */
        #page-onboarding {
            display: none; /* Hide by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #1e0033 0%, #3d1c5a 50%, #5f3781 100%);
        }
        #page-onboarding.active {
            display: flex;
        }
        .onboarding-slides { display: flex; transition: transform 0.5s ease-in-out; width: 300%; }
        .onboarding-slide { width: 100%; padding: 2rem; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 1rem; }
        .onboarding-icon { width: 100px; height: 100px; background: var(--glass-bg); border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 1px solid var(--glass-border); }
        .onboarding-dots { display: flex; gap: 0.5rem; margin-top: 2rem; }
        .onboarding-dot { width: 10px; height: 10px; background: var(--glass-border); border-radius: 50%; transition: all 0.3s ease; }
        .onboarding-dot.active { background: var(--text-color); transform: scale(1.2); }


        /* Success Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: all 0.3s ease-in-out; z-index: 100; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { text-align: center; padding: 2.5rem; transform: scale(0.8); transition: transform 0.3s ease-in-out; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .success-checkmark { width: 100px; height: 100px; border-radius: 50%; display: block; stroke-width: 3; stroke: #fff; stroke-miterlimit: 10; box-shadow: inset 0px 0px 0px var(--primary-color); animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both; margin: 0 auto 1.5rem auto; }
        .checkmark-circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 3; stroke-miterlimit: 10; stroke: var(--primary-color); fill: none; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
        .checkmark-check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        @keyframes scale { 0%, 100% { transform: none; } 50% { transform: scale3d(1.1, 1.1, 1); } }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 60px var(--primary-color); } }

    </style>
</head>
<body>

    <div id="page-onboarding" class="page">
        <div style="width:100vw; overflow:hidden;">
            <div class="onboarding-slides" id="onboarding-slides-container">
                <div class="onboarding-slide">
                    <div class="onboarding-icon"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="m16 14-4 4-2-2"/></svg></div>
                    <h2 class="text-2xl font-bold">Plan the Perfect Walk</h2>
                    <p class="opacity-80">Easily schedule walks that fit your and your dog's needs.</p>
                </div>
                <div class="onboarding-slide">
                    <div class="onboarding-icon"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
                    <h2 class="text-2xl font-bold">Choose a Trusted Walker</h2>
                    <p class="opacity-80">Select from a list of verified, top-rated walkers in your area.</p>
                </div>
                <div class="onboarding-slide">
                    <div class="onboarding-icon"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg></div>
                    <h2 class="text-2xl font-bold">Track Every Step</h2>
                    <p class="opacity-80">Follow along with live GPS tracking and get photo updates.</p>
                </div>
            </div>
        </div>
        <div class="onboarding-dots" id="onboarding-dots-container"></div>
        <div class="mt-8 px-8 w-full max-w-sm">
            <button id="onboarding-next-btn" class="btn btn-primary w-full">Next</button>
        </div>
    </div>
    
    <div class="app-container">
        <!-- MAIN CONTENT AREA FOR ALL PAGES -->
        <main class="main-content">
            <div class="page-content-wrapper">

                <!-- ===== PAGE: HOME/DASHBOARD ===== -->
                <section class="page" id="page-home">
                    <div class="space-y-8 stagger-in">
                        <div class="text-center pt-4">
                            <h1 class="text-3xl font-bold">Hello, Alex!</h1>
                            <p class="opacity-80">Ready for a new adventure? üêæ</p>
                        </div>
                        
                        <div id="upcoming-walk-section">
                            <h2 class="text-lg font-semibold mb-3">Upcoming Walk</h2>
                            <div id="upcoming-walk-card" class="glass-card p-4 flex items-center gap-4 cursor-pointer" data-walk-id="99">
                                <img src="https://placehold.co/100x100/7F00FF/FFFFFF?text=J" alt="Jordan Lee" class="w-12 h-12 rounded-full">
                                <div>
                                    <p class="font-semibold">With Jordan Lee</p>
                                    <p class="text-sm opacity-80">Today at 4:00 PM</p>
                                </div>
                                <div class="ml-auto text-right">
                                    <p class="font-bold">30 min</p>
                                    <p class="text-sm opacity-80">üê∂ Buddy</p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                             <button id="cta-book-walk" class="btn btn-primary w-full text-base py-4">Book New Walk</button>
                             <button id="cta-recurring-walk" class="btn btn-secondary w-full text-base py-4">Schedule Walk</button>
                        </div>

                        <div>
                             <h2 class="text-lg font-semibold mb-3">Recent Activity</h2>
                             <div class="space-y-3" id="recent-activity-list"></div>
                        </div>
                    </div>
                </section>
                
                <!-- ===== PAGE: BOOKING FLOW CONTAINER ===== -->
                <section class="page booking-flow-page" id="page-booking-flow"></section>
                
                <!-- ===== PAGE: WALK HISTORY ===== -->
                <section class="page" id="page-history">
                     <div class="page-header"><div class="placeholder"></div><h1>Walk History</h1></div>
                    <div class="space-y-4" id="history-list-container"></div>
                </section>

                <!-- ===== PAGE: WALK SUMMARY ===== -->
                <section class="page" id="page-walk-summary">
                     <!-- Dynamic Content -->
                </section>

                <!-- ===== PAGE: MY DOGS ===== -->
                <section class="page" id="page-dogs">
                    <div class="page-header"><div class="placeholder"></div><h1>My Dogs</h1></div>
                    <div class="space-y-4" id="dog-list-container"></div>
                    <button id="btn-add-dog" class="btn btn-secondary w-full mt-6">Add New Dog</button>
                </section>
                
                <!-- ===== PAGE: ADD/EDIT DOG ===== -->
                <section class="page" id="page-dog-form">
                     <!-- Dynamic Content -->
                </section>

                <!-- ===== PAGE: INBOX ===== -->
                <section class="page" id="page-inbox">
                    <div class="page-header"><div class="placeholder"></div><h1>Messages</h1></div>
                    <div class="space-y-3" id="inbox-list-container"></div>
                </section>

                <!-- ===== PAGE: CHAT ===== -->
                <section class="page" id="page-chat">
                     <!-- Dynamic Content -->
                </section>
                
                <!-- ===== PAGE: PROFILE ===== -->
                <section class="page" id="page-profile">
                    <div class="page-header"><div class="placeholder"></div><h1>My Profile</h1></div>
                    <div class="space-y-6">
                        <div class="flex flex-col items-center">
                            <img src="https://placehold.co/150x150/9370DB/FFFFFF?text=A" class="w-24 h-24 rounded-full border-4 border-[var(--glass-border)]">
                            <h2 class="text-2xl font-bold mt-4">Alex Morgan</h2>
                            <p class="opacity-70">alex.morgan@email.com</p>
                        </div>
                        <div class="glass-card p-4 divide-y divide-[var(--glass-border)]">
                            <a href="#" class="profile-link py-3 flex justify-between items-center"><span>Edit Profile</span><span>></span></a>
                            <a href="#" class="profile-link py-3 flex justify-between items-center" data-target="page-payments"><span>Payment Methods</span><span>></span></a>
                            <a href="#" class="profile-link py-3 flex justify-between items-center" data-target="page-promotions"><span>Promotions & Referrals</span><span>></span></a>
                            <a href="#" class="profile-link py-3 flex justify-between items-center"><span>Help & Support</span><span>></span></a>
                        </div>
                        <button class="btn btn-secondary w-full">Log Out</button>
                    </div>
                </section>

                <!-- ===== PAGE: WALKER PROFILE ===== -->
                <section class="page" id="page-walker-profile">
                     <!-- Dynamic Content -->
                </section>

                <!-- ===== PAGE: LIVE WALK TRACKING ===== -->
                 <section class="page" id="page-live-tracking">
                     <!-- Dynamic Content -->
                 </section>

                 <!-- ===== PAGE: RECURRING WALKS ===== -->
                 <section class="page" id="page-recurring-walks">
                      <!-- Dynamic Content -->
                 </section>
                 
                 <!-- ===== PAGE: PAYMENTS ===== -->
                 <section class="page" id="page-payments">
                      <!-- Dynamic Content -->
                 </section>

                 <!-- ===== PAGE: PROMOTIONS ===== -->
                 <section class="page" id="page-promotions">
                      <!-- Dynamic Content -->
                 </section>

            </div>
        </main>

        <!-- BOTTOM NAVIGATION BAR -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-target="page-home">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span>Home</span>
            </button>
            <button class="nav-item" data-target="page-history">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                <span>History</span>
            </button>
             <button class="nav-item" data-target="page-inbox">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22v-7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v7"/><path d="M4 18h.01"/><path d="M2 14h.01"/><path d="M22 14h-.01"/><path d="M18 18h.01"/><path d="M6 18h.01"/><path d="M12 18h.01"/><path d="M16 5.86a4.5 4.5 0 1 0-8 0c0 1.5.63 3.05 1.76 4.14L12 12l2.24-2c1.13-1.09 1.76-2.64 1.76-4.14Z"/></svg>
                <span>Messages</span>
            </button>
            <button class="nav-item" data-target="page-dogs">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.66 22.47a2.5 2.5 0 0 0 2.68 0l.28-.11a1.23 1.23 0 0 1 1.2 0l.35.14a2.5 2.5 0 0 0 2.52 0l.28-.11a1.23 1.23 0 0 1 1.2 0l.35.14a2.5 2.5 0 0 0 2.52 0l.28-.11a1.23 1.23 0 0 1 1.2 0l.35.14a2.5 2.5 0 0 0 2.52 0V8.29a2.5 2.5 0 0 0-1.26-2.17l-.35-.18a1.23 1.23 0 0 1-.6-1.08V4.5a2.5 2.5 0 0 0-2.5-2.5h-2.5"/><path d="M2.12 12.21a2.5 2.5 0 0 0-1.26 2.17v.3a2.5 2.5 0 0 0 2.5 2.5h.5a1.23 1.23 0 0 1 1.2 1.2v.3a2.5 2.5 0 0 0 2.5 2.5h.5a1.23 1.23 0 0 1 1.2 1.2v.3a2.5 2.5 0 0 0 2.5 2.5h.5"/></svg>
                <span>Dogs</span>
            </button>
            <button class="nav-item" data-target="page-profile">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <span>Profile</span>
            </button>
        </nav>
    </div>

    <!-- Success Modal will be appended to body by JS to ensure it's on top -->
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- MOCK DATA ---
        let dogData = [
            { id: 1, name: 'Buddy', avatar: 'üê∂', breed: 'Golden Retriever', age: 4, notes: 'Loves fetch, avoids loud noises.', vet: 'Parkside Vet Clinic', allergies: 'None', likes: 'Squeaky toys', dislikes: 'Skateboards' },
            { id: 2, name: 'Lucy', avatar: 'üê©', breed: 'Poodle', age: 7, notes: 'A bit shy at first. Prefers quiet streets.', vet: 'Uptown Animals', allergies: 'Chicken', likes: 'Belly rubs', dislikes: 'Loud trucks' },
            { id: 3, name: 'Max', avatar: 'üêï', breed: 'German Shepherd', age: 2, notes: 'Very energetic! Needs a long run.', vet: 'Parkside Vet Clinic', allergies: 'None', likes: 'Frisbees', dislikes: 'Mail carriers' },
        ];
        const walkerData = [
            { id: 1, name: 'Alex Ray', avatar: 'https://placehold.co/100x100/7F00FF/FFFFFF?text=A', verified: true, rating: 4.9, reviews: 124, price: 25, bio: "Hi, I'm Alex! I've been a passionate dog lover my whole life and have 5+ years of professional walking experience. I'm certified in Pet First Aid and can't wait to meet your furry friend!", badges: ["Pet CPR Certified", "5+ Years Exp."], favorite: true },
            { id: 2, name: 'Jordan Lee', avatar: 'https://placehold.co/100x100/8A2BE2/FFFFFF?text=J', verified: true, rating: 4.8, reviews: 98, price: 24, bio: "Jordan is a marathon runner who loves taking high-energy dogs on long adventures. If your pup needs to burn off some steam, I'm your walker.", badges: ["Great with Large Dogs"], favorite: false },
            { id: 3, name: 'Casey Smith', avatar: 'https://placehold.co/100x100/9370DB/FFFFFF?text=C', verified: false, rating: 4.7, reviews: 75, price: 22, bio: "As a veterinary student, I have a deep understanding of animal care and behavior. I'm especially good with shy or anxious dogs.", badges: ["Experience with Puppies"], favorite: true },
        ];
        let walkHistoryData = [
            { id: 99, date: '2025-09-16', time: '16:00', walker: walkerData[1], dogs: [dogData[0]], price: 25.00, status: 'In Progress' },
            { id: 1, date: '2025-09-11', walker: walkerData[1], dogs: [dogData[0]], price: 25.00, status: 'Completed', photos: ['https://placehold.co/300x200/5f3781/FFFFFF?text=Buddy+Playing', 'https://placehold.co/300x200/8A2BE2/FFFFFF?text=Happy+Pup'], activity: { pee: true, poo: true, water: true }, note: "Buddy had a great time at the park. Full of energy today!" },
            { id: 2, date: '2025-09-09', walker: walkerData[0], dogs: [dogData[0], dogData[1]], price: 40.00, status: 'Completed', photos: [], activity: { pee: true, poo: false, water: true }, note: "Lucy was a little shy but warmed up. Buddy was great as always." },
            { id: 3, date: '2025-09-05', walker: walkerData[2], dogs: [dogData[2]], price: 22.00, status: 'Completed', photos: ['https://placehold.co/300x200/9370DB/FFFFFF?text=Max+Running'], activity: { pee: true, poo: true, water: false }, note: "Max loved the long run by the lake!" },
        ];
        const inboxData = [
            { id: 1, walkerId: 1, lastMessage: "Sounds good, see you then!", unread: false },
            { id: 3, walkerId: 3, lastMessage: "Yes, I can be there a few minutes early.", unread: true },
        ];
        const chatData = {
            1: [{sender:'walker', text:'Hi Alex, just confirming our walk with Buddy for tomorrow at 4pm!'}, {sender:'user', text:'Yep, looks good!'}, {sender:'walker', text:"Sounds good, see you then!"}],
            3: [{sender:'walker', text:'Hi, just wanted to check if Max has any issues with other dogs at the park.'}, {sender:'user', text:'He is usually very friendly!'}, {sender:'walker', text:"Yes, I can be there a few minutes early."}],
        };
        const paymentData = {
            card: { type: 'Visa', last4: '4242', expiry: '12/26'},
            transactions: [{date: '2025-09-11', desc: 'Walk with Jordan L.', amount: 25.00}, {date: '2025-09-09', desc: 'Walk with Alex R.', amount: 40.00}]
        };

        // --- APP STATE ---
        const appState = { currentPage: 'page-home' };
        
        // --- BOOKING FLOW HTML ---
        const fullBookingFlowHTML = `
            <div class="page-header"><button class="back-btn" data-target="page-home"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button><h1>Book a Walk</h1></div>
            <div class="progress-bar" id="progressBar">
                <div class="progress-line"></div><div class="progress-line-active" id="progressLineActive"></div>
                <div class="progress-step active" id="step-0"><div class="progress-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="m16 14-4 4-2-2"/></svg></div><span class="progress-label">Plan</span></div>
                <div class="progress-step" id="step-1"><div class="progress-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div><span class="progress-label">Walker</span></div>
                <div class="progress-step" id="step-2"><div class="progress-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></div><span class="progress-label">Review</span></div>
            </div>
            <div id="booking-screens-container">
                <section class="screen active" id="screen1">
                    <div class="space-y-6 stagger-in">
                        <h2 class="text-lg font-semibold">Service</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="checkable-card"><input type="radio" name="service" value="30" data-price="25" checked><div class="card-content glass-card p-4"><div class="text-2xl font-bold">30 min</div><div class="text-lg opacity-80">$25</div></div></label>
                            <label class="checkable-card"><input type="radio" name="service" value="60" data-price="40"><div class="card-content glass-card p-4"><div class="text-2xl font-bold">60 min</div><div class="text-lg opacity-80">$40</div></div></label>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><h2 class="text-lg font-semibold mb-3">Date</h2><div class="input-group"><input type="date" id="walk-date" class="input-field"></div></div>
                            <div><h2 class="text-lg font-semibold mb-3">Time</h2><div class="input-group"><input type="time" id="walk-time" class="input-field"></div></div>
                        </div>
                        <div><h2 class="text-lg font-semibold mb-3">Address</h2><div class="input-group px-4"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-50"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg><input type="text" id="address" placeholder="e.g., 123 Bark Ave" class="input-field"></div></div>
                        <div><h2 class="text-lg font-semibold mb-3">Select Dogs</h2><div id="dog-selection" class="grid grid-cols-2 sm:grid-cols-4 gap-4"></div></div>
                        <div><h2 class="text-lg font-semibold mb-3">Special Instructions</h2><div class="input-group"><textarea id="instructions" placeholder="He loves belly rubs!" class="input-field h-24 resize-none"></textarea></div></div>
                        <button id="toScreen2Btn" class="btn btn-primary w-full" disabled>Continue</button>
                    </div>
                </section>
                <section class="screen" id="screen2">
                    <div class="space-y-6 stagger-in">
                         <div class="flex flex-wrap gap-2 mb-4" id="filterChips">
                            <button class="chip active flex-1 btn btn-secondary" data-filter="nearest">Nearest</button>
                             <button class="chip flex-1 btn btn-secondary" data-filter="favorites">Favorites ‚òÖ</button>
                            <button class="chip flex-1 btn btn-secondary" data-filter="price">Price</button>
                            <button class="chip flex-1 btn btn-secondary" data-filter="top-rated">Top Rated</button>
                        </div>
                        <div id="walker-list" class="space-y-4"></div>
                        <div class="grid grid-cols-2 gap-4 pt-4">
                            <button id="backTo1Btn" class="btn btn-secondary">Back</button>
                            <button id="toScreen3Btn" class="btn btn-primary" disabled>Continue</button>
                        </div>
                    </div>
                </section>
                <section class="screen" id="screen3">
                    <div class="space-y-6 stagger-in">
                        <div class="glass-card p-5 space-y-3">
                            <h2 class="text-lg font-semibold">Walk Details</h2>
                            <div id="summary-details" class="divide-y divide-[var(--glass-border)]"></div>
                        </div>
                        <div class="glass-card p-5 space-y-3">
                            <h2 class="text-lg font-semibold">Price Summary</h2>
                            <div id="price-details" class="divide-y divide-[var(--glass-border)]"></div>
                            <div class="flex justify-between items-center font-bold text-lg border-t border-[var(--glass-border)] pt-3 mt-3">
                                <span>Total</span><span id="total-price"></span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 pt-4">
                            <button id="backTo2Btn" class="btn btn-secondary">Back</button>
                            <button id="bookWalkBtn" class="btn btn-primary">Book Walk</button>
                        </div>
                    </div>
                </section>
            </div>`;
        
        // --- ALL APP FUNCTIONS ---

        const goToPage = (pageId, context = null) => {
            vibrate();
            const pages = document.querySelectorAll('.page');
            const navItems = document.querySelectorAll('.nav-item');
            const mainContent = document.querySelector('.main-content');
            const appContainer = document.querySelector('.app-container');

            pages.forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                const isFullScreenPage = ['page-booking-flow', 'page-live-tracking', 'page-chat', 'page-onboarding'].includes(pageId);
                
                if (document.querySelector('.bottom-nav')) {
                    document.querySelector('.bottom-nav').style.display = isFullScreenPage ? 'none' : 'flex';
                }
                if (appContainer) {
                    appContainer.style.display = pageId === 'page-onboarding' ? 'none' : 'flex';
                }
            }
            
            navItems.forEach(item => item.classList.toggle('active', item.dataset.target === pageId));
            
            appState.currentPage = pageId;
            if(mainContent) mainContent.scrollTop = 0;
            
            switch (pageId) {
                case 'page-home': renderDashboard(); break;
                case 'page-history': renderHistoryPage(); break;
                case 'page-walk-summary': if (context?.walkId) renderWalkSummary(context.walkId); break;
                case 'page-dogs': renderDogsPage(); break;
                case 'page-dog-form': renderDogForm(context?.dogId); break;
                case 'page-inbox': renderInboxPage(); break;
                case 'page-chat': if (context?.walkerId) renderChatPage(context.walkerId); break;
                case 'page-walker-profile': if (context?.walkerId) renderWalkerProfile(context.walkerId, context.backTarget); break;
                case 'page-live-tracking': if (context?.walkId) renderLiveTracking(context.walkId); break;
                case 'page-recurring-walks': renderRecurringWalksPage(); break;
                case 'page-payments': renderPaymentsPage(); break;
                case 'page-promotions': renderPromotionsPage(); break;
            }
        };

        function vibrate(duration = 10) { if (window.navigator.vibrate) window.navigator.vibrate(duration); }
        
        function renderDashboard() {
            const upcomingWalk = walkHistoryData.find(w => w.status === 'In Progress');
            const upcomingSection = document.getElementById('upcoming-walk-section');
            if (upcomingWalk) {
                upcomingSection.style.display = 'block';
                const upcomingCard = document.getElementById('upcoming-walk-card');
                upcomingCard.onclick = () => goToPage('page-live-tracking', { walkId: upcomingWalk.id });
            } else {
                upcomingSection.style.display = 'none';
            }
            document.getElementById('recent-activity-list').innerHTML = walkHistoryData.filter(w => w.status === 'Completed').slice(0, 2).map(walk => `
                <div class="glass-card p-3 flex items-center gap-3">
                    <img src="${walk.walker.avatar}" class="w-10 h-10 rounded-full">
                    <div><p class="font-semibold">Walk with ${walk.walker.name}</p><p class="text-xs opacity-70">${new Date(walk.date+'T00:00:00').toLocaleDateString()}</p></div>
                    <span class="ml-auto font-bold text-sm">$${walk.price.toFixed(2)}</span>
                </div>`).join('');
        }
        
        function renderHistoryPage() {
            document.getElementById('history-list-container').innerHTML = walkHistoryData.map(walk => `
                <div class="glass-card p-4 cursor-pointer walk-history-item" data-walk-id="${walk.id}">
                    <div class="flex justify-between items-center">
                        <div><p class="font-bold text-lg">${new Date(walk.date + 'T00:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}</p><p class="text-sm opacity-80">With ${walk.walker.name}</p></div>
                        <div class="text-right"><p class="font-bold text-lg">$${walk.price.toFixed(2)}</p><p class="text-sm opacity-80">${walk.dogs.map(d => d.avatar).join(' ')}</p></div>
                    </div>
                </div>`).join('');
            
            document.querySelectorAll('.walk-history-item').forEach(item => {
                item.addEventListener('click', e => {
                    const walkId = parseInt(e.currentTarget.dataset.walkId);
                    const walk = walkHistoryData.find(w => w.id === walkId);
                    if (walk.status === 'In Progress') {
                        goToPage('page-live-tracking', { walkId });
                    } else {
                        goToPage('page-walk-summary', { walkId });
                    }
                });
            });
        }
        
        function renderWalkSummary(walkId) {
            const walk = walkHistoryData.find(w => w.id === walkId);
            if (!walk) return;
            const container = document.getElementById('page-walk-summary');
            container.innerHTML = `
                <div class="page-header"><button class="back-btn" data-target="page-history"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button><h1>Walk Summary</h1></div>
                <div class="space-y-6">
                    <div class="glass-card overflow-hidden"><img src="https://placehold.co/600x300/3d1c5a/E0E0E0?text=Walk+Route+Map" alt="Map of walk route"></div>
                    <div class="glass-card p-4 flex items-center gap-4"><img src="${walk.walker.avatar}" class="w-16 h-16 rounded-full"><div><p class="opacity-80">Your walker was</p><p class="font-bold text-xl">${walk.walker.name}</p></div></div>
                    ${(walk.photos && walk.photos.length > 0) ? `<div class="glass-card p-4"><h3 class="font-semibold mb-3">Photo Gallery</h3><div class="grid grid-cols-3 gap-2">${walk.photos.map(p => `<img src="${p}" class="rounded-lg w-full h-24 object-cover">`).join('')}</div></div>` : ''}
                    ${walk.activity ? `<div class="glass-card p-4"><h3 class="font-semibold mb-3">Activity Report</h3><div class="flex justify-around text-center">${['Pee', 'Poo', 'Water'].map(act => `<div><div class="w-12 h-12 rounded-full flex items-center justify-center mx-auto ${walk.activity[act.toLowerCase()] ? 'bg-green-500/50' : 'bg-red-500/50'}">${walk.activity[act.toLowerCase()] ? '‚úì' : '‚úó'}</div><p class="text-xs mt-1">${act}</p></div>`).join('')}</div></div>` : ''}
                    <div class="glass-card p-4"><h3 class="font-semibold mb-2">Walker's Note</h3><p class="opacity-80 italic">"${walk.note}"</p></div>
                </div>`;
        }

        function renderDogsPage() {
             document.getElementById('dog-list-container').innerHTML = dogData.map(dog => `
                <div class="glass-card p-4 flex items-center gap-4">
                    <span class="text-5xl">${dog.avatar}</span>
                    <div class="flex-grow"><p class="font-bold text-lg">${dog.name}</p><p class="text-sm opacity-80">${dog.breed}, ${dog.age} years old</p></div>
                    <button class="btn-secondary px-3 py-2 text-sm rounded-lg dog-edit-btn" data-dog-id="${dog.id}">Edit</button>
                </div>`).join('');
             document.querySelectorAll('.dog-edit-btn').forEach(btn => btn.addEventListener('click', e => goToPage('page-dog-form', { dogId: parseInt(e.currentTarget.dataset.dogId) })));
        }
        
        function renderDogForm(dogId = null) {
            const dog = dogId ? dogData.find(d => d.id === dogId) : null;
            const title = dog ? 'Edit Dog Profile' : 'Add a New Dog';
            const container = document.getElementById('page-dog-form');
            container.innerHTML = `
                <div class="page-header"><button class="back-btn" data-target="page-dogs"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button><h1>${title}</h1></div>
                <form id="dog-form" class="space-y-4">
                    <h3 class="font-semibold">Basic Info</h3>
                    <div class="input-group"><input name="name" type="text" placeholder="Dog's Name" required class="input-field" value="${dog?.name || ''}"></div>
                    <div class="input-group"><input name="breed" type="text" placeholder="Breed" required class="input-field" value="${dog?.breed || ''}"></div>
                    <div class="input-group"><input name="age" type="number" placeholder="Age (years)" required class="input-field" value="${dog?.age || ''}"></div>
                    <h3 class="font-semibold pt-2">Health & Care</h3>
                    <div class="input-group"><input name="vet" type="text" placeholder="Veterinarian" class="input-field" value="${dog?.vet || ''}"></div>
                    <div class="input-group"><input name="allergies" type="text" placeholder="Allergies" class="input-field" value="${dog?.allergies || ''}"></div>
                    <h3 class="font-semibold pt-2">Behavior</h3>
                    <div class="input-group"><input name="likes" type="text" placeholder="Likes (e.g., toys, parks)" class="input-field" value="${dog?.likes || ''}"></div>
                    <div class="input-group"><input name="dislikes" type="text" placeholder="Dislikes (e.g., loud noises)" class="input-field" value="${dog?.dislikes || ''}"></div>
                    <button type="submit" class="btn btn-primary w-full !mt-6">Save Profile</button>
                </form>`;
            
            document.getElementById('dog-form').addEventListener('submit', e => {
                e.preventDefault();
                // Logic to save dog data would go here
                goToPage('page-dogs');
            });
        }
        
        function renderInboxPage() {
            document.getElementById('inbox-list-container').innerHTML = inboxData.map(convo => {
                const walker = walkerData.find(w => w.id === convo.walkerId);
                return `
                <div class="glass-card p-4 flex items-center gap-4 cursor-pointer inbox-item" data-walker-id="${walker.id}">
                     <img src="${walker.avatar}" class="w-14 h-14 rounded-full">
                     <div class="flex-grow">
                        <div class="flex justify-between items-start">
                             <p class="font-bold text-lg">${walker.name}</p>
                             ${convo.unread ? `<span class="w-3 h-3 bg-blue-500 rounded-full mt-1"></span>` : ''}
                        </div>
                        <p class="text-sm opacity-80 truncate">${convo.lastMessage}</p>
                     </div>
                </div>`
            }).join('');
            document.querySelectorAll('.inbox-item').forEach(item => item.addEventListener('click', e => goToPage('page-chat', { walkerId: parseInt(e.currentTarget.dataset.walkerId) })));
        }

        function renderChatPage(walkerId) {
            const walker = walkerData.find(w => w.id === walkerId);
            const messages = chatData[walkerId] || [];
            const container = document.getElementById('page-chat');
            container.innerHTML = `
                <div class="page-header"><button class="back-btn" data-target="page-inbox"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button><h1>${walker.name}</h1></div>
                <div class="space-y-4 mb-20">
                    ${messages.map(msg => `<div class="flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}"><div class="chat-bubble ${msg.sender}">${msg.text}</div></div>`).join('')}
                </div>
                <div class="fixed bottom-4 left-0 right-0 max-w-xl mx-auto px-4"><div class="input-group"><input type="text" placeholder="Type a message..." class="input-field pr-20"><button class="absolute right-2 btn btn-primary py-2 px-3 text-sm">Send</button></div></div>
            `;
        }
        
        function renderWalkerProfile(walkerId, backTarget = 'page-home') {
             const walker = walkerData.find(w => w.id === walkerId);
            if (!walker) return;
            const container = document.getElementById('page-walker-profile');
            container.innerHTML = `
                <div class="page-header">
                    <button class="back-btn" data-target="${backTarget}"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>
                    <h1>Walker Profile</h1>
                    <button class="favorite-btn p-2 ${walker.favorite ? 'favorited' : ''}" data-walker-id="${walker.id}"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></button>
                </div>
                <div class="space-y-6 stagger-in">
                    <div class="flex flex-col items-center"><img src="${walker.avatar}" class="w-28 h-28 rounded-full border-4 border-[var(--glass-border)]"><h2 class="text-2xl font-bold mt-4">${walker.name}</h2><p class="opacity-70">‚òÖ ${walker.rating} (${walker.reviews} Reviews)</p></div>
                    <div class="flex justify-center gap-2">${walker.badges.map(b => `<span class="bg-[var(--glass-bg)] text-xs font-semibold px-3 py-1 rounded-full">${b}</span>`).join('')}</div>
                    <div class="glass-card p-5"><h3 class="font-semibold mb-2">About Me</h3><p class="opacity-80">${walker.bio}</p></div>
                    <div class="glass-card p-5"><h3 class="font-semibold mb-2">Reviews</h3><div class="space-y-3"><div class="flex gap-2"><p class="font-bold">Anna K.</p><p>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</p></div><p class="opacity-80 text-sm italic">"Alex was amazing with my energetic puppy!"</p></div></div>
                </div>`;
            
            container.querySelector('.favorite-btn').addEventListener('click', e => {
                const button = e.currentTarget;
                const id = parseInt(button.dataset.walkerId);
                const targetWalker = walkerData.find(w => w.id === id);
                targetWalker.favorite = !targetWalker.favorite;
                button.classList.toggle('favorited');
            });
        }

        function renderLiveTracking(walkId) {
            const walk = walkHistoryData.find(w => w.id === walkId);
            if (!walk) return;
            const container = document.getElementById('page-live-tracking');
            container.innerHTML = `
                <div class="page-header"><button class="back-btn" data-target="page-home"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button><h1>Live Walk</h1></div>
                <div class="space-y-4">
                     <div class="glass-card non-hover overflow-hidden h-64 flex items-center justify-center"><img src="https://placehold.co/600x400/3d1c5a/E0E0E0?text=Live+Map" alt="Live Map" class="w-full h-full object-cover"></div>
                     <div class="glass-card non-hover p-4 text-center"><p class="text-lg">Time Remaining</p><p class="text-4xl font-bold">21:47</p></div>
                     <div class="glass-card non-hover p-4"><div class="flex items-center gap-4"><img src="${walk.walker.avatar}" class="w-12 h-12 rounded-full"><p class="font-semibold">${walk.walker.name} is walking ${walk.dogs.map(d=>d.name).join(', ')}</p></div></div>
                     <div class="glass-card non-hover p-4"><h3 class="font-semibold mb-2">Send a Message</h3><div class="input-group"><input type="text" placeholder="Great job!" class="input-field pr-20"><button class="absolute right-2 btn btn-primary py-2 px-3 text-sm">Send</button></div></div>
                </div>`;
        }
        
        function renderRecurringWalksPage() {
            const container = document.getElementById('page-recurring-walks');
            container.innerHTML = `<div class="page-header"><button class="back-btn" data-target="page-home"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button><h1>Scheduled Walks</h1></div><div class="space-y-4"><div class="glass-card p-4"><div class="flex justify-between items-center"><p class="font-bold">Mon, Wed, Fri</p><span class="text-sm bg-green-500/50 px-2 py-1 rounded-full">Active</span></div><p class="text-sm opacity-80">9:00 AM, 30 min with Alex R.</p></div><button class="btn btn-primary w-full">Set Up New Schedule</button></div>`;
        }

        function renderPaymentsPage() {
            const container = document.getElementById('page-payments');
            container.innerHTML = `<div class="page-header"><button class="back-btn" data-target="page-profile"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button><h1>Payments</h1></div><div class="space-y-6"><div class="glass-card p-5"><h3 class="font-semibold mb-3">My Card</h3><div class="flex items-center gap-4"><img src="https://placehold.co/60x40/FFFFFF/000000?text=VISA" class="w-12 rounded-md"><p>**** **** **** ${paymentData.card.last4}</p><p class="ml-auto text-sm opacity-80">Exp ${paymentData.card.expiry}</p></div></div><div class="glass-card p-5"><h3 class="font-semibold mb-3">Transaction History</h3><div class="space-y-2">${paymentData.transactions.map(t => `<div class="flex justify-between text-sm"><p>${t.desc}</p><p>$${t.amount.toFixed(2)}</p></div>`).join('')}</div></div><button class="btn btn-secondary w-full">Add New Card</button></div>`;
        }
        
        function renderPromotionsPage() {
             const container = document.getElementById('page-promotions');
             container.innerHTML = `<div class="page-header"><button class="back-btn" data-target="page-profile"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button><h1>Promotions</h1></div><div class="space-y-6"><div class="glass-card p-5 text-center"><h3 class="font-semibold mb-2">Refer a Friend, Get $10!</h3><p class="opacity-80 text-sm mb-4">Share your code and you'll both get $10 off your next walk.</p><div class="p-3 bg-black/20 rounded-lg font-mono tracking-widest">ALEX-WALKS-25</div></div><div class="glass-card p-5"><h3 class="font-semibold mb-3">Active Promos</h3><div class="p-3 bg-primary-color/20 rounded-lg"><p class="font-bold">15% Off All 60-Min Walks</p><p class="text-sm opacity-80">Valid this weekend only. Auto-applied at checkout.</p></div></div></div>`;
        }

        function fullInitBookingFlow() {
            const bookingState = {};
            let currentScreen = 0;
            const screens = document.querySelectorAll('#page-booking-flow .screen');
            const progressBar = { line: document.getElementById('progressLineActive'), steps: [document.getElementById('step-0'), document.getElementById('step-1'), document.getElementById('step-2')] };
            const toScreen2Btn = document.getElementById('toScreen2Btn');

            function goToBookingScreen(screenIndex) {
                vibrate();
                if(screens[currentScreen]) screens[currentScreen].classList.remove('active');
                if(screens[screenIndex]) screens[screenIndex].classList.add('active');
                currentScreen = screenIndex;
                updateProgressBar();
            }

            function updateProgressBar() {
                progressBar.steps.forEach((step, i) => step.classList.toggle('active', i <= currentScreen));
                progressBar.line.style.width = `${currentScreen * 50}%`;
            }

            function showSuccessModal() {
                vibrate(50);
                const modalHTML = `<div class="modal-overlay active" id="successModal"><div class="modal-content glass-card"><svg class="success-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg><h2 class="text-2xl font-bold mb-2">Booking Confirmed!</h2><p class="opacity-80">Your dog's adventure is scheduled.</p><button id="modal-back-to-home" class="btn btn-primary mt-4 w-full">Back to Home</button></div></div>`;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                document.getElementById('modal-back-to-home').addEventListener('click', () => {
                    document.getElementById('successModal').remove();
                    const newWalk = { id: Date.now(), date: bookingState.dateTime.date, walker: bookingState.selectedWalker, dogs: bookingState.selectedDogs, price: bookingState.total, status: 'Upcoming' };
                    walkHistoryData.unshift(newWalk);
                    goToPage('page-home');
                });
            }

            // Init Screen 1
            const tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('walk-date').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('walk-date').min = tomorrow.toISOString().split('T')[0];
            document.getElementById('walk-time').value = '10:00';
            document.getElementById('dog-selection').innerHTML = dogData.map(dog => `<label class="checkable-card"><input type="checkbox" name="dogs" value="${dog.id}"><div class="card-content glass-card p-4 flex flex-col items-center"><span class="text-4xl">${dog.avatar}</span><span class="font-semibold mt-2">${dog.name}</span></div><div class="checkmark"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></div></label>`).join('');
            
            function validateScreen1() {
                const serviceChecked = document.querySelector('input[name="service"]:checked');
                bookingState.service = { duration: parseInt(serviceChecked.value), price: parseFloat(serviceChecked.dataset.price) };
                bookingState.dateTime = { date: document.getElementById('walk-date').value, time: document.getElementById('walk-time').value };
                bookingState.address = document.getElementById('address').value.trim();
                bookingState.selectedDogs = Array.from(document.querySelectorAll('input[name="dogs"]:checked')).map(cb => dogData.find(d => d.id === parseInt(cb.value)));
                toScreen2Btn.disabled = !(bookingState.address.length > 2 && bookingState.dateTime.date && bookingState.dateTime.time && bookingState.selectedDogs.length > 0);
            }
            document.getElementById('screen1').addEventListener('input', validateScreen1);
            validateScreen1();

            // Init Screen 2
            function renderWalkerList(walkers) {
                document.getElementById('toScreen3Btn').disabled = true;
                const walkerList = document.getElementById('walker-list');
                walkerList.innerHTML = Array(3).fill('').map(() => `<div class="glass-card p-4 flex gap-4 items-center animate-pulse"><div class="w-16 h-16 rounded-full bg-[var(--glass-border)]"></div><div class="flex-1 space-y-2"><div class="h-4 w-3/4 rounded bg-[var(--glass-border)]"></div><div class="h-3 w-1/2 rounded bg-[var(--glass-border)]"></div></div></div>`).join('');
                
                setTimeout(() => {
                    if (walkers.length === 0) {
                         walkerList.innerHTML = `<p class="text-center opacity-80">No walkers match your criteria.</p>`;
                         return;
                    }
                    walkerList.innerHTML = walkers.map(w => `<div class="walker-card-container relative"><input type="radio" name="walker" value="${w.id}" class="hidden" id="walker-radio-${w.id}"><label for="walker-radio-${w.id}" class="glass-card p-4 flex gap-4 items-center cursor-pointer"><img src="${w.avatar}" alt="${w.name}" class="w-16 h-16 rounded-full view-profile-btn" data-walker-id="${w.id}"><div class="flex-1"> <div class="flex items-center gap-2"><h3 class="font-bold text-lg">${w.name}</h3>${w.verified ? `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#3b82f6" stroke="white" stroke-width="1"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`:''}</div><p class="text-sm opacity-80">‚òÖ ${w.rating.toFixed(1)} (${w.reviews} reviews)</p></div><div class="text-right"><p class="text-xl font-bold">$${w.price.toFixed(2)}</p></div></label><button class="favorite-btn absolute top-3 right-3 p-2 ${w.favorite ? 'favorited' : ''}" data-walker-id="${w.id}"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></button></div>`).join('');
                    walkerList.querySelectorAll('input[name="walker"]').forEach(radio => radio.addEventListener('change', e => {
                        bookingState.selectedWalker = walkerData.find(w => w.id === parseInt(e.target.value));
                        document.getElementById('toScreen3Btn').disabled = false;
                        walkerList.querySelectorAll('.glass-card').forEach(c => c.style.borderColor = 'var(--glass-border)');
                        e.target.nextElementSibling.style.borderColor = 'var(--primary-color-light)';
                    }));
                    walkerList.querySelectorAll('.view-profile-btn').forEach(btn => btn.addEventListener('click', e => {
                        e.stopPropagation();
                        goToPage('page-walker-profile', { walkerId: parseInt(e.target.dataset.walkerId), backTarget: 'page-booking-flow' });
                    }));
                    walkerList.querySelectorAll('.favorite-btn').forEach(btn => btn.addEventListener('click', e => {
                        e.stopPropagation();
                        const walkerId = parseInt(e.currentTarget.dataset.walkerId);
                        const walker = walkerData.find(w => w.id === walkerId);
                        walker.favorite = !walker.favorite;
                        e.currentTarget.classList.toggle('favorited');
                    }));
                }, 500);
            }

            renderWalkerList(walkerData);
            document.getElementById('filterChips').addEventListener('click', e => {
                const button = e.target.closest('button');
                if (button) {
                    document.querySelectorAll('#filterChips .chip').forEach(c => c.classList.remove('active'));
                    button.classList.add('active');
                    let sorted = [...walkerData];
                    const filter = button.dataset.filter;
                    if (filter === 'price') sorted.sort((a, b) => a.price - b.price);
                    else if (filter === 'top-rated') sorted.sort((a, b) => b.rating - a.rating);
                    else if (filter === 'favorites') sorted = sorted.filter(w => w.favorite);
                    renderWalkerList(sorted);
                }
            });
            
            // Init Screen 3
            function renderReviewScreen() {
                bookingState.total = bookingState.selectedWalker.price;
                document.getElementById('summary-details').innerHTML = `<div class="py-2 flex justify-between"><span>Date & Time</span><span class="text-right font-semibold">${bookingState.dateTime.date} at ${bookingState.dateTime.time}</span></div> <div class="py-2 flex justify-between"><span>Dogs</span><span class="text-right font-semibold">${bookingState.selectedDogs.map(d=>d.name).join(', ')}</span></div> <div class="py-2 flex justify-between"><span>Walker</span><span class="text-right font-semibold">${bookingState.selectedWalker.name}</span></div>`;
                document.getElementById('price-details').innerHTML = `<div class="py-2 flex justify-between"><span>Walk Price</span> <span>$${bookingState.total.toFixed(2)}</span></div>`;
                document.getElementById('total-price').textContent = `$${bookingState.total.toFixed(2)}`;
            }

            // Booking Flow Navigation
            toScreen2Btn.addEventListener('click', () => goToBookingScreen(1));
            document.getElementById('backTo1Btn').addEventListener('click', () => goToBookingScreen(0));
            document.getElementById('toScreen3Btn').addEventListener('click', () => { renderReviewScreen(); goToBookingScreen(2); });
            document.getElementById('backTo2Btn').addEventListener('click', () => goToBookingScreen(1));
            document.getElementById('bookWalkBtn').addEventListener('click', showSuccessModal);
        }

        function initOnboarding() {
            let currentSlide = 0;
            const slidesContainer = document.getElementById('onboarding-slides-container');
            const dotsContainer = document.getElementById('onboarding-dots-container');
            const nextBtn = document.getElementById('onboarding-next-btn');
            const totalSlides = 3;

            for(let i=0; i < totalSlides; i++) {
                dotsContainer.innerHTML += `<div class="onboarding-dot ${i === 0 ? 'active' : ''}" data-slide="${i}"></div>`;
            }
            const dots = dotsContainer.querySelectorAll('.onboarding-dot');

            function updateOnboardingUI() {
                slidesContainer.style.transform = `translateX(-${currentSlide * (100 / totalSlides)}%)`;
                dots.forEach((dot, i) => dot.classList.toggle('active', i === currentSlide));
                if (currentSlide === totalSlides - 1) {
                    nextBtn.textContent = 'Get Started';
                } else {
                    nextBtn.textContent = 'Next';
                }
            }
            
            nextBtn.addEventListener('click', () => {
                if (currentSlide < totalSlides - 1) {
                    currentSlide++;
                    updateOnboardingUI();
                } else {
                    try {
                        localStorage.setItem('onboardingComplete', 'true');
                    } catch(e) { console.error("Could not set localStorage.") }
                    goToPage('page-home');
                }
            });
        }

        // --- APP INITIALIZATION ---
        function initApp() { 
            let onboardingComplete = false;
            try {
                onboardingComplete = localStorage.getItem('onboardingComplete') === 'true';
            } catch (e) {
                console.error("Could not access localStorage. Defaulting to onboarding.", e);
            }

            if (onboardingComplete) {
                goToPage('page-home');
            } else {
                initOnboarding();
                goToPage('page-onboarding');
            }
        }

        // Add main event listeners
        document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', () => goToPage(item.dataset.target)));
        document.body.addEventListener('click', e => {
             const backBtn = e.target.closest('.back-btn');
             const profileLink = e.target.closest('.profile-link');
             if (backBtn) {
                 goToPage(backBtn.dataset.target);
             } else if(profileLink && profileLink.dataset.target) {
                 e.preventDefault();
                 goToPage(profileLink.dataset.target);
             }
        });
        document.getElementById('cta-book-walk').addEventListener('click', () => {
            document.getElementById('page-booking-flow').innerHTML = fullBookingFlowHTML;
            fullInitBookingFlow();
            goToPage('page-booking-flow');
        });
        document.getElementById('cta-recurring-walk').addEventListener('click', () => goToPage('page-recurring-walks'));
        document.getElementById('btn-add-dog').addEventListener('click', () => goToPage('page-dog-form'));

        // Start the app
        initApp();
    });
    </script>
</body>
</html>

